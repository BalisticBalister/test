"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[1355],{3173:(e,t,o)=>{o.d(t,{Z:()=>l});var n=o(87363),r=o.n(n),i=o(86976);const s=(0,i.Z)({resolved:{},chunkName:()=>"BalancePopup.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!o.m[t]},importAsync:()=>Promise.all([o.e(6122),o.e(7821),o.e(1036),o.e(6210)]).then(o.bind(o,99785)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then((e=>(this.resolved[t]=!0,e)))},requireSync(e){const t=this.resolve(e);return o(t)},resolve(){return 99785}},{}),l=s},8629:(e,t,o)=>{o.d(t,{Z:()=>l});var n=o(87363),r=o.n(n),i=o(86976);const s=(0,i.Z)({resolved:{},chunkName:()=>"BalanceRefill.component.async",isReady(e){const t=this.resolve(e);return!0===this.resolved[t]&&!!o.m[t]},importAsync:()=>Promise.all([o.e(6122),o.e(7821),o.e(1036),o.e(2900)]).then(o.bind(o,77967)),requireAsync(e){const t=this.resolve(e);return this.resolved[t]=!1,this.importAsync(e).then((e=>(this.resolved[t]=!0,e)))},requireSync(e){const t=this.resolve(e);return o(t)},resolve(){return 77967}},{}),l=s},44965:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o(8629).Z},14678:(e,t,o)=>{o.d(t,{Z:()=>W});var n=o(85383),r=o(73694),i=o(63904),s=o.n(i),l=o(87363),a=o.n(l),c=o(53726),p=o(19146),u=o(45331);const h=o(3173).Z;var d=o(44965),f=o(38677),y=o(8065),m=o(70556),v=o(33119),w=o(46986),b=o(36172),g=o(41225),A=o(83326),S=o(97808),T=o(72461),E=o(98343),P=o(73984),O=o(34967),C=o(65118),R=(o(48810),o(47484)),U=o(41952),B=o(40656),x=o(93298),D=o(15771),_=o(49659),F=o(15513);var L=o(68606),j=o(89592),k=Object.defineProperty,V=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,N=(e,t,o)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,$=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&N(e,o,t[o]);if(V)for(var o of V(t))I.call(t,o)&&N(e,o,t[o]);return e};const z=(0,x.M$)("Balance",x.XG.Dev),q=s().with("balance"),M=B.s2/4,G=B.dV;class H extends l.PureComponent{constructor(){super(...arguments),this.popupAnchorRef=a().createRef(),this.balancePending=!1,this.state={canShowSpinner:!0,popupAutoOpen:!0,refillVisible:!1,rewarded:!1},this.handlePageShow=e=>{var t,o,n;let{persisted:r}=e;if(!r&&window.performance){const e=null==(o=(t=window.performance).getEntriesByType)?void 0:o.call(t,"navigation")[0];if(e){if("back_forward"!==e.type)return;r=e.responseEnd-e.requestStart<=50}else{if(2!==(null==(n=window.performance.navigation)?void 0:n.type))return;const e=window.performance.timing;if(!e)return;r=e.responseEnd-e.requestStart<=50}}r&&this.fetchBalance({forceFetch:!0})},this.reportUserActivity=()=>{document.hidden?this.reportUserActivityTimeout=window.setTimeout(this.reportUserActivity,G):(this.props.reportUserActivity(),this.reportUserActivityTimeout=window.setTimeout(this.reportUserActivity,M))},this.onClick=e=>{var t,o;null==(o=(t=this.props).onClick)||o.call(t,e);const n=(0,L.hY)(L.jF.GUARD);n?(0,L.Vy)(n.children):(this.props.isBalanceFetched||this.props.fetchUserBalance({forceFetch:!1}),"game"!==this.props.type?this.props.setUserBalancePopupVisible(!this.props.popupVisible):S.Z.post({type:"payments",action:"balance-refill",data:{paymentsConfig:{lang:this.context.lang}}}))},this.onShow=()=>{this.clearAutoCloseTimeout(),this.clearShowTimeout(),this.props.popupVisible||this.props.reportUserActivity(),this.setState({popupAutoOpen:this.props.popupVisible}),"catalog"===this.props.type?(0,O.NF)({},j.Ji.PORTAL_CURRENCY_ON_BOARD_CLICK,{source:j.qg.Catalog,version:j.Sq.AllFeatures}):(0,O.NF)({},j.Ji.PORTAL_CURRENCY_ON_BOARD_CLICK,{source:j.qg.Play,version:j.Sq.AllFeatures})},this.onPopupClose=()=>{this.clearAutoCloseTimeout(),this.hide()},this.onPopupRefill=()=>{return e=this,t=null,o=function*(){const e=()=>{this.setState({refillVisible:!0},(()=>{this.props.setShouldShowShortcutPopup(!1)}))};if((0,C.$r)(this.context))try{const{status:e}=yield(0,C.H)(z);"PURCHASED"===e&&this.fetchBalance({forceFetch:!0})}catch(e){}else e()},new Promise(((n,r)=>{var i=e=>{try{l(o.next(e))}catch(e){r(e)}},s=e=>{try{l(o.throw(e))}catch(e){r(e)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,s);l((o=o.apply(e,t)).next())}));var e,t,o},this.onRefillClose=()=>{this.setState({refillVisible:!1},(()=>{this.props.setShouldShowShortcutPopup(!0)}))}}componentDidMount(){this.reportUserActivity(),window.addEventListener("pageshow",this.handlePageShow),(0,F.Fg)(this.context,(0,_.e)().pathname),this.fetchBalance({forceFetch:!1})}componentWillUnmount(){this.clearAutoCloseTimeout(),this.clearReportUserActivityTimeout(),this.clearShowTimeout(),window.removeEventListener("pageshow",this.handlePageShow)}componentDidUpdate(e){const t=e.activity,o=this.props.activity;!e.popupVisible&&this.props.popupVisible&&this.onShow(),t.fetching&&!o.fetching&&this.fetchBalance({forceFetch:!0}),e.balance!==this.props.balance&&0!==e.userBalance.fetchedTimestamp&&((0,T.X)({bubbles:10,colors:E.lF,node:this.popupAnchorRef.current}),this.setState({canShowSpinner:!0})),(0,P.v)(t.value,o.value)||(z(`\n            prevDays = ${t.value.days}, prevTotal = ${t.value.total}\n\n            currentDays = ${o.value.days}, currentTotal = ${o.value.total}\n        `),this.tryShow({popupAutoOpen:!0,rewarded:Boolean(o.value.balance_diff)},{isPopupVisible:!0}))}render(){const{popupVisible:e,balanceFetching:t,activity:o,isBalanceFetched:n,getText:i}=this.props,s=(!n||o.fetching||t)&&this.state.canShowSpinner,l=e,c=(0,D.XP)(this.context.abt.flags)?f.j.NONE:f.j.PARTIAL;return a().createElement("div",{className:q({type:this.props.type}),"data-nosnippet":"true",title:i("user-popup.balance")},a().createElement("span",{className:q("portal-currency-wrapper",{active:l}),ref:this.popupAnchorRef,onClick:this.onClick},a().createElement(y.Z,{amount:s?a().createElement(r.y,{className:q("spinner"),size:16,spinning:!0,view:"default"}):this.props.balance,gradient:c,iconPosition:"start",iconSize:m.T.SMALL,showSpinner:!1})),!this.props.disablePopups&&this.props.popupVisible&&a().createElement(h,{anchorRef:this.popupAnchorRef,onClose:this.onPopupClose,onRefill:this.onPopupRefill}),this.state.refillVisible&&a().createElement(d.Z,{passportOrigin:U._4.GamesCatalogPurchases,onClose:this.onRefillClose}))}tryShow(e,t={}){this.clearAutoCloseTimeout(),this.clearShowTimeout(),!0!==e.popupAutoOpen?(0,L.Vm)()?this.showTimeoutId=window.setTimeout((()=>this.tryShow(e)),5e3):document.hidden||(e.rewarded&&this.fetchBalance({forceFetch:!0}),this.setState($($({},this.state),e)),this.props.setUserBalancePopupVisible(Boolean(t.isPopupVisible))):this.context.abt.flags}hide(){this.clearShowTimeout(),this.setState({popupAutoOpen:!1}),this.props.setUserBalancePopupVisible(!1)}clearShowTimeout(){this.showTimeoutId&&(window.clearTimeout(this.showTimeoutId),this.showTimeoutId=void 0)}clearAutoCloseTimeout(){this.autoCloseTimeoutId&&(window.clearTimeout(this.autoCloseTimeoutId),this.autoCloseTimeoutId=void 0)}clearReportUserActivityTimeout(){this.reportUserActivityTimeout&&(window.clearTimeout(this.reportUserActivityTimeout),this.reportUserActivityTimeout=void 0)}fetchBalance({forceFetch:e}){const{fetchUserBalance:t,location:o}=this.props;if((0,F.Fg)(this.context,o.pathname)&&!this.props.isBalanceFetched){if(this.balancePending)return;return this.balancePending=!0,void(0,R.UQ)((()=>{this.balancePending=!1,this.props.isBalanceFetched||t({forceFetch:e})}))}t({forceFetch:e})}}H.contextType=u.Z;const W=(0,n.E)((0,c.$j)((function(e){var t;const o=e.user.balance;return{activity:(0,g._)(e),balance:(0,A.n)(e),balanceFetching:o.fetching,getText:e.getText,isBalanceFetched:o.fetchedTimestamp>0,isMiddleLayerShow:Boolean(null==(t=e.middleLayerInGameData)?void 0:t.show),popupVisible:Boolean(o.isBalancePopupVisible),theme:(0,b.FS)(e),userBalance:o}}),(function(e){return(0,p.DE)({fetchUserBalance:w.Zc,reportUserActivity:w.eC,showUserActivity:w.c2,setUserBalancePopupVisible:w.sw,setShouldShowShortcutPopup:v.M4},e)}))(H))},13378:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o(70556).Z},70556:(e,t,o)=>{o.d(t,{T:()=>c,Z:()=>h});var n=o(63904),r=o.n(n),i=o(87363),s=o.n(i),l=o(45331),a=o(15201),c=(e=>(e.EXTRA_LARGE="xl",e.LARGE="l",e.LARGE_FLAT="lf",e.MEDIUM="m",e.SMALL="s",e))(c||{});const p=r().with("portal-currency-icon");class u extends i.PureComponent{render(){const{size:e}=this.props,{moneyCodeSymbol:t}=this.context,o="lf"===e||"xl"===e;return s().createElement(a.Z,{className:p({size:e,type:t.toLocaleLowerCase()}),size:o?"l":e,type:"portal-currency"})}}u.contextType=l.Z;const h=u},8065:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o(38677).Z},38677:(e,t,o)=>{o.d(t,{j:()=>u,Z:()=>f});var n=o(63904),r=o.n(n),i=o(87363),s=o.n(i),l=o(45331),a=o(13378);const c=({children:e,gradient:t,mix:o=""})=>{const n="text-gradient "+("none"!==t?"text-gradient-fill":"");return s().createElement("span",{className:`${n} ${o}`},e)};var p=o(60592),u=(e=>(e.FULL="full",e.NONE="none",e.PARTIAL="partial",e))(u||{});const h=r().with("portal-currency");class d extends i.PureComponent{renderAmount(){const{amount:e}=this.props;return void 0===e?null:"number"!=typeof e?e:(0,p.Z)(e)}render(){const{gradient:e="none",iconPosition:t="end",iconSize:o,showSpinner:n}=this.props;return o?s().createElement("span",{className:h({"spinner-features":n})},"start"===t&&s().createElement(s().Fragment,null,s().createElement(a.Z,{size:o})," "),s().createElement(c,{gradient:e,mix:`${h("value")}${n?` ${h("spinner")}`:""}`},this.renderAmount()),"end"===t&&s().createElement(s().Fragment,null," ",s().createElement(a.Z,{size:o}))):s().createElement("span",{className:h()},"partial"===e&&this.renderAmount(),s().createElement(c,{gradient:e,mix:`${h("value")}${n?` ${h("spinner")}`:""}`},"full"===e&&this.renderAmount()," ",this.context.moneyCodeSymbol))}}d.contextType=l.Z;const f=d},41225:(e,t,o)=>{o.d(t,{_:()=>n});const n=e=>e.user.activity},83326:(e,t,o)=>{o.d(t,{n:()=>A,F:()=>S});var n=Object.defineProperty,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(e,t,o)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))i.call(t,o)&&l(e,o,t[o]);if(r)for(var o of r(t))s.call(t,o)&&l(e,o,t[o]);return e};function c(e,t="expected a function, instead received "+typeof e){if("function"!=typeof e)throw new TypeError(t)}var p=e=>Array.isArray(e)?e:[e];function u(e){const t=Array.isArray(e[0])?e[0]:e;return function(e,t="expected all items to be functions, instead received the following types: "){if(!e.every((e=>"function"==typeof e))){const o=e.map((e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e)).join(", ");throw new TypeError(`${t}[${o}]`)}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}Symbol(),Object.getPrototypeOf({});var h="undefined"!=typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}},d=0,f=1;function y(){return{s:d,v:void 0,o:null,p:null}}function m(e,t={}){let o=y();const{resultEqualityCheck:n}=t;let r,i=0;function s(){var t,s;let l=o;const{length:a}=arguments;for(let e=0,t=a;e<t;e++){const t=arguments[e];if("function"==typeof t||"object"==typeof t&&null!==t){let e=l.o;null===e&&(l.o=e=new WeakMap);const o=e.get(t);void 0===o?(l=y(),e.set(t,l)):l=o}else{let e=l.p;null===e&&(l.p=e=new Map);const o=e.get(t);void 0===o?(l=y(),e.set(t,l)):l=o}}const c=l;let p;if(l.s===f)p=l.v;else if(p=e.apply(null,arguments),i++,n){const e=null!=(s=null==(t=null==r?void 0:r.deref)?void 0:t.call(r))?s:r;null!=e&&n(e,p)&&(p=e,0!==i&&i--);r="object"==typeof p&&null!==p||"function"==typeof p?new h(p):p}return c.s=f,c.v=p,p}return s.clearCache=()=>{o=y(),s.resetResultsCount()},s.resultsCount=()=>i,s.resetResultsCount=()=>{i=0},s}function v(e,...t){const o="function"==typeof e?{memoize:e,memoizeOptions:t}:e,n=(...e)=>{let t,n=0,r=0,i={},s=e.pop();"object"==typeof s&&(i=s,s=e.pop()),c(s,`createSelector expects an output function after the inputs, but received: [${typeof s}]`);const l=a(a({},o),i),{memoize:h,memoizeOptions:d=[],argsMemoize:f=m,argsMemoizeOptions:y=[],devModeChecks:v={}}=l,w=p(d),b=p(y),g=u(e),A=h((function(){return n++,s.apply(null,arguments)}),...w);const S=f((function(){r++;const e=function(e,t){const o=[],{length:n}=e;for(let r=0;r<n;r++)o.push(e[r].apply(null,t));return o}(g,arguments);return t=A.apply(null,e),t}),...b);return Object.assign(S,{resultFunc:s,memoizedResultFunc:A,dependencies:g,dependencyRecomputations:()=>r,resetDependencyRecomputations:()=>{r=0},lastResult:()=>t,recomputations:()=>n,resetRecomputations:()=>{n=0},memoize:h,argsMemoize:f})};return Object.assign(n,{withTypes:()=>n}),n}var w=v(m),b=Object.assign(((e,t=w)=>{!function(e,t="expected an object, instead received "+typeof e){if("object"!=typeof e)throw new TypeError(t)}(e,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);const o=Object.keys(e);return t(o.map((t=>e[t])),((...e)=>e.reduce(((e,t,n)=>(e[o[n]]=t,e)),{})))}),{withTypes:()=>b});const g=e=>{const{error:t,fetchedTimestamp:o,value:n}=e;return!t&&o&&"number"==typeof n?n:""},A=e=>g(e.user.balance),S=w((e=>e.user.balance),(e=>g(e)))},60592:(e,t,o)=>{function n(e){return e.split("").reverse().join("")}function r(e){if(e<1e4)return String(e);try{return new Intl.NumberFormat("ru-RU").format(e)}catch(e){}return function(e){let t=n(String(e));return t=t.replace(/(\d{1,3})/g," $1"),n(t)}(e)}o.d(t,{Z:()=>r})},65118:(e,t,o)=>{o.d(t,{$r:()=>p,H:()=>l,I4:()=>c,rj:()=>a});var n=(e,t,o)=>new Promise(((n,r)=>{var i=e=>{try{l(o.next(e))}catch(e){r(e)}},s=e=>{try{l(o.throw(e))}catch(e){r(e)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,s);l((o=o.apply(e,t)).next())}));const r=new Error("Billing not supported"),i=new Error("No such method in window.yandex.billing");function s(){return n(this,null,(function*(){var e,t,o,n;if("function"!=typeof(null==(t=null==(e=window.yandex)?void 0:e.billing)?void 0:t.isBillingSupported))return console.error("typeof billing.isBillingSupported is not a function"),!1;try{return null==(n=null==(o=window.yandex)?void 0:o.billing)?void 0:n.isBillingSupported()}catch(e){return console.error("isBillingSupported error",e),!1}}))}function l(e){return n(this,null,(function*(){var t,o,n,l;if(!(yield s()))throw r;if("function"!=typeof(null==(o=null==(t=window.yandex)?void 0:t.billing)?void 0:o.showTopUpDialog))throw console.error("typeof billing.showTopUpDialog is not a function"),i;try{const t=yield null==(l=null==(n=window.yandex)?void 0:n.billing)?void 0:l.showTopUpDialog();return null==e||e("native balance top up dialog closed with result:",t),t}catch(e){throw console.error("billing.showTopUpDialog error",e),e}}))}function a(e,t){return n(this,null,(function*(){var o,n,l,a;if(!(yield s()))throw r;if("function"!=typeof(null==(n=null==(o=window.yandex)?void 0:o.billing)?void 0:n.showBuyDisableAdDialog))throw console.error("typeof billing.showBuyDisableAdDialog is not a function"),i;try{const o=yield null==(a=null==(l=window.yandex)?void 0:l.billing)?void 0:a.showBuyDisableAdDialog(e);return null==t||t("native disable ad dialog closed with result:",o),o}catch(e){throw console.error("billing.showBuyDisableAdDialog error",e),e}}))}function c(e,t){return n(this,arguments,(function*({description:e,image:t,price:o,title:n},l){var a,c,p,u;if(!(yield s()))throw r;if("function"!=typeof(null==(c=null==(a=window.yandex)?void 0:a.billing)?void 0:c.showBuyItemDialog))throw console.error("typeof billing.showBuyItemDialog is not a function"),i;try{const r=yield null==(u=null==(p=window.yandex)?void 0:p.billing)?void 0:u.showBuyItemDialog(o,n,e,t);return null==l||l("native buy item dialog closed with result:",r),r}catch(e){throw console.error("billing.showBuyItemDialog error",e),e}}))}function p(e){return!1}},96952:(e,t,o)=>{o.d(t,{D:()=>n});const n=e=>{if("undefined"==typeof window)throw new Error("Function must be called in browser env");window.requestAnimationFrame((()=>{window.setTimeout(e,0)}))}},45583:(e,t,o)=>{o.d(t,{l:()=>d});var n=o(37705),r=o(13377),i=Object.defineProperty,s=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,t,o)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,h=(e,t)=>{for(var o in t||(t={}))c.call(t,o)&&u(e,o,t[o]);if(a)for(var o of a(t))p.call(t,o)&&u(e,o,t[o]);return e};const d=(e,t,o,i)=>{const a=((e,t={})=>{const o=new AbortController,n=o.signal;return{fetch:fetch(e,(r=h({},t),i={signal:n},s(r,l(i)))),abortController:o};var r,i})(t);let c=!1;return a.fetch.then((e=>e.blob())).then((t=>(e.src=URL.createObjectURL(t),c=!0,o()))).catch((s=>{if("AbortError"!==s.name)return!(null==i?void 0:i.isFallback)&&(null==i?void 0:i.fallbackUrl)?((0,n.H)({additional:{mainUrl:t,fallbackUrl:i.fallbackUrl},block:r.W.VIDEO_LOADER,message:`Error while video loading with main URL, trying fallback URL ${s.message}`},s),d(e,i.fallbackUrl,o,{isFallback:!0})):void(0,n.H)({block:r.W.VIDEO_LOADER,message:`Error while video loading ${s.message}`},s)})),{abort:()=>{c||a.abortController.abort()},element:e}}},68606:(e,t,o)=>{o.d(t,{Vm:()=>i,Vy:()=>l,hY:()=>s,jF:()=>r});const n=[".adv-game-loader",".app-drawer_status_full",".app-drawer_status_small",".drawer_visible",".Drawer_visible",".guard-enabled",".LegoPopup2_visible",".merge-conflicts-dialog",".merge-conflicts",".modal-wrapper_visible",".play-shortcut-popup-desktop",".Popup2_visible",".prowo_visible",".scopes-dialog",".scopes",".shortcut-popup-desktop",".user-activity-popup"].join(", "),r={GUARD:".guard-enabled, .play-guard-dialog:not(.play-guard-dialog_hidden)"};function i(){return document.querySelector(n)}function s(e){return"string"==typeof e&&(e=[e]),document.querySelector(e.join(", "))}function l(e){const t=e instanceof HTMLCollection||Array.isArray(e)?Array.from(e):[e];t.forEach((e=>e.classList.remove("shake"))),window.requestAnimationFrame((()=>t.forEach((e=>e.classList.add("shake")))))}}}]);
//# sourceMappingURL=https://s3.mdst.yandex.net/games/source-maps/_/build/client/game/desktop/playhop/1355.12335100544f3aed2a60.js.map